<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FounderOS | Ultimate Brand & Business Builder</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@400;700&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- THEME VARIABLES --- */
        :root {
            --primary: #2563EB;
            --primary-dark: #1E40AF;
            --secondary: #64748B;
            --accent: #F59E0B;
            --bg-body: #F1F5F9;
            --bg-panel: #FFFFFF;
            --text-main: #0F172A;
            --text-light: #64748B;
            --border: #E2E8F0;
            --radius: 8px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --font-main: 'Inter', sans-serif;
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; padding: 0; font-family: var(--font-main); background: var(--bg-body); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        /* --- LAYOUT --- */
        aside { 
            width: 260px; background: #0F172A; color: white; display: flex; flex-direction: column; 
            flex-shrink: 0; z-index: 50; transition: width 0.3s;
        }
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        /* --- SIDEBAR --- */
        .brand { padding: 1.5rem; font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; font-weight: 700; letter-spacing: -1px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #1E293B; }
        .brand i { color: var(--primary); }
        .nav-menu { padding: 1rem; flex: 1; overflow-y: auto; }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px; width: 100%; text-align: left;
            background: transparent; border: none; color: #94A3B8; cursor: pointer; border-radius: 6px;
            font-weight: 500; margin-bottom: 4px; transition: all 0.2s; font-size: 0.95rem;
        }
        .nav-item:hover { background: #1E293B; color: white; }
        .nav-item.active { background: var(--primary); color: white; }
        
        /* --- SCROLLABLE CONTENT AREA --- */
        .workspace { flex: 1; overflow-y: auto; padding: 2rem; scroll-behavior: smooth; }
        .section-view { display: none; animation: fadeIn 0.3s ease-out; max-width: 1400px; margin: 0 auto; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- UI COMPONENTS --- */
        h1 { font-size: 2rem; margin: 0 0 0.5rem 0; color: #1E293B; letter-spacing: -0.5px; }
        h2 { font-size: 1.25rem; margin: 1.5rem 0 1rem 0; color: #334155; }
        p.subtitle { color: var(--text-light); margin-bottom: 2rem; max-width: 700px; }

        .card { background: var(--bg-panel); border-radius: var(--radius); border: 1px solid var(--border); padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm); }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1rem; }

        .form-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; color: #475569; }
        input, select, textarea {
            width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;
            font-size: 0.95rem; font-family: var(--font-main); transition: border 0.2s;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 6px;
            font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.95rem;
        }
        .btn:hover { background: var(--primary-dark); transform: translateY(-1px); }
        .btn-outline { background: white; border: 1px solid var(--border); color: var(--text-main); }
        .btn-outline:hover { background: #F8FAFC; border-color: #CBD5E1; }
        .btn-sm { padding: 6px 12px; font-size: 0.85rem; }
        .btn-danger { background: #EF4444; color: white; }
        .btn-danger:hover { background: #DC2626; }

        /* --- NAME GENERATOR STYLES --- */
        .name-badge {
            background: white; border: 1px solid var(--border); padding: 1rem; border-radius: 8px;
            position: relative; overflow: hidden; cursor: pointer; transition: all 0.2s;
        }
        .name-badge:hover { border-color: var(--primary); box-shadow: var(--shadow-sm); transform: translateY(-2px); }
        .name-badge.selected { border: 2px solid var(--primary); background: #EFF6FF; }
        .name-badge h3 { margin: 0; font-size: 1.2rem; color: #1E293B; }
        .name-meta { font-size: 0.75rem; color: #64748B; display: flex; justify-content: space-between; margin-top: 8px; }
        .avail-dot { height: 8px; width: 8px; background: #10B981; border-radius: 50%; display: inline-block; margin-right: 4px; }

        /* --- BUILDER UI STYLES --- */
        .builder-layout { display: flex; gap: 20px; height: calc(100vh - 120px); }
        .builder-sidebar { width: 340px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; padding-right: 10px; }
        .builder-canvas { flex: 1; background: #E2E8F0; border-radius: 12px; overflow: hidden; border: 1px solid #CBD5E1; position: relative; }
        .canvas-frame { width: 100%; height: 100%; border: none; background: white; }

        .section-item {
            background: white; border: 1px solid var(--border); border-radius: 6px; margin-bottom: 8px;
            overflow: hidden; transition: all 0.2s;
        }
        .section-header {
            padding: 10px 15px; background: #F8FAFC; cursor: pointer; display: flex; 
            justify-content: space-between; align-items: center; font-weight: 600; font-size: 0.9rem;
        }
        .section-header:hover { background: #F1F5F9; }
        .section-body { padding: 15px; border-top: 1px solid var(--border); display: none; }
        .section-body.open { display: block; }

        .control-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .range-slider { width: 100%; }
        
        /* Mobile */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            aside { width: 100%; height: auto; flex-direction: row; align-items: center; padding: 0.5rem; }
            .nav-menu { display: flex; padding: 0; overflow-x: auto; }
            .nav-item { margin: 0 5px; width: auto; white-space: nowrap; }
            .builder-layout { flex-direction: column; height: auto; }
            .builder-sidebar { width: 100%; max-height: 400px; }
            .builder-canvas { height: 500px; }
        }
    </style>
</head>
<body>

<aside>
    <div class="brand"><i class="ph-fill ph-rocket-launch"></i> FounderOS</div>
    <nav class="nav-menu">
        <button class="nav-item active" onclick="app.route('profile')"><i class="ph ph-user-circle"></i> Business Profile</button>
        <button class="nav-item" onclick="app.route('branding')"><i class="ph ph-magic-wand"></i> Premium Branding</button>
        <button class="nav-item" onclick="app.route('strategy')"><i class="ph ph-chart-line-up"></i> Strategy & Roadmap</button>
        <button class="nav-item" onclick="app.route('builder')"><i class="ph ph-desktop"></i> Pro Website Builder</button>
    </nav>
    <div style="padding: 1.5rem; font-size: 0.8rem; color: #475569; border-top: 1px solid #1E293B;">
        Local Mode ‚Ä¢ v3.0
    </div>
</aside>

<main>
    <div class="workspace">

        <div id="view-profile" class="section-view active">
            <h1>Business DNA</h1>
            <p class="subtitle">Enter your details once. We use this to generate your brand, strategy, and website.</p>
            
            <div class="card">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Primary Industry</label>
                        <select id="p-industry">
                            <option value="food">Food & Beverage (e.g. Traditional/Modern)</option>
                            <option value="tech">SaaS / Technology / App</option>
                            <option value="fashion">Fashion & Lifestyle</option>
                            <option value="service">Freelance / Agency / Consulting</option>
                            <option value="health">Health & Wellness</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Seed Keyword (e.g. Brownie, Code, Yoga)</label>
                        <input type="text" id="p-keyword" placeholder="e.g. Brownie">
                    </div>
                </div>
                <div class="form-group">
                    <label>Business Description</label>
                    <textarea id="p-desc" rows="3" placeholder="e.g. Making traditional kelveragu brownies with a modern healthy twist..."></textarea>
                </div>
                <div class="form-group">
                    <label>Target Audience</label>
                    <input type="text" id="p-audience" placeholder="e.g. Gen-Z health enthusiasts in urban areas">
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Business Phone (For WhatsApp Link)</label>
                        <input type="text" id="p-phone" placeholder="+91 9876543210">
                    </div>
                    <div class="form-group">
                        <label>Business Email</label>
                        <input type="email" id="p-email" placeholder="contact@business.com">
                    </div>
                </div>
                <button class="btn" onclick="app.saveProfile()">Save & Continue <i class="ph ph-arrow-right"></i></button>
            </div>
        </div>

        <div id="view-branding" class="section-view">
            <h1>Brand Identity Engine</h1>
            <p class="subtitle">Generate high-value, pronounceable names (Abstract, Compound, or Blended).</p>

            <div class="card">
                <div class="form-group">
                    <label>Name Style Preference</label>
                    <div style="display: flex; gap: 15px; margin-top: 5px;">
                        <label style="font-weight: normal;"><input type="checkbox" id="style-abstract" checked> Abstract (e.g. Nike, Zomato)</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="style-compound" checked> Compound (e.g. Facebook)</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="style-tech" checked> Modern/Tech (e.g. Spotify)</label>
                    </div>
                </div>
                <button class="btn" onclick="modules.branding.generate()">Generate Names</button>
            </div>

            <div class="grid-3" id="name-results"></div>
            <div id="selected-brand-display" style="margin-top: 20px; padding: 15px; background: #ECFDF5; border: 1px solid #10B981; border-radius: 6px; display: none;">
                <strong style="color: #047857;">Selected Brand: <span id="current-brand-name">None</span></strong>
                <p style="font-size: 0.85rem; margin-top: 5px;">This name is now applied to your Website Builder.</p>
            </div>
        </div>

        <div id="view-strategy" class="section-view">
            <h1>Strategic Roadmap</h1>
            <p class="subtitle">Market fit analysis and step-by-step execution plan.</p>
            
            <button class="btn" onclick="modules.strategy.run()">Run Analysis</button>

            <div id="strategy-content" style="display: none; margin-top: 1.5rem;">
                <div class="card">
                    <h2>üöÄ Execution Roadmap</h2>
                    <div id="roadmap-list" style="display: flex; flex-direction: column; gap: 10px;"></div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h2>üí° Business Idea Refinement</h2>
                        <ul id="idea-tips" style="padding-left: 20px; color: #475569; line-height: 1.6;"></ul>
                    </div>
                    <div class="card">
                        <h2>‚ö†Ô∏è Competitor Watchlist</h2>
                        <div id="competitor-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-builder" class="section-view">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h1>Pro Website Builder</h1>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" onclick="modules.builder.refresh()"><i class="ph ph-arrows-clockwise"></i> Refresh</button>
                    <button class="btn" onclick="modules.builder.export()"><i class="ph ph-download-simple"></i> Export HTML</button>
                </div>
            </div>

            <div class="builder-layout">
                <div class="builder-sidebar">
                    
                    <div class="card" style="padding: 10px; margin-bottom: 10px;">
                        <h4 style="margin: 0 0 10px 0;">üé® Global Theme</h4>
                        <div class="form-group">
                            <label>Preset Theme</label>
                            <select id="site-theme" onchange="modules.builder.applyTheme()">
                                <option value="modern">Modern Startup (Blue/Clean)</option>
                                <option value="luxury">Luxury/Premium (Black/Serif)</option>
                                <option value="playful">Playful/Food (Orange/Round)</option>
                                <option value="minimal">Minimalist (Greyscale)</option>
                            </select>
                        </div>
                        <div class="grid-2" style="gap: 5px;">
                            <div><label>Primary Color</label><input type="color" id="site-color" onchange="modules.builder.refresh()"></div>
                            <div><label>Text Color</label><input type="color" id="site-text-color" value="#111827" onchange="modules.builder.refresh()"></div>
                        </div>
                    </div>

                    <div class="card" style="padding: 10px; margin-bottom: 10px; background: #F8FAFC;">
                        <h4 style="margin: 0 0 10px 0;">‚ûï Add Component</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                            <button class="btn btn-outline btn-sm" onclick="modules.builder.add('hero')">Hero</button>
                            <button class="btn btn-outline btn-sm" onclick="modules.builder.add('features')">Features</button>
                            <button class="btn btn-outline btn-sm" onclick="modules.builder.add('gallery')">Gallery</button>
                            <button class="btn btn-outline btn-sm" onclick="modules.builder.add('contact')">Contact</button>
                            <button class="btn btn-outline btn-sm" onclick="modules.builder.add('text')">Rich Text</button>
                            <button class="btn btn-outline btn-sm" onclick="modules.builder.add('cta')">CTA</button>
                        </div>
                    </div>

                    <div id="section-list-container"></div>

                </div>

                <div class="builder-canvas">
                    <iframe id="preview-frame" class="canvas-frame"></iframe>
                </div>
            </div>
        </div>

    </div>
</main>

<script>
    // --- APP STORE ---
    const store = {
        profile: {
            industry: 'food', keyword: '', desc: '', audience: '', phone: '', email: ''
        },
        branding: {
            selectedName: 'BrandZero'
        },
        builder: {
            theme: 'modern',
            primaryColor: '#2563EB',
            textColor: '#0F172A',
            sections: [
                { id: 's1', type: 'hero', title: 'Welcome to BrandZero', subtitle: 'The future of innovation starts here.', btnText: 'Get Started' },
                { id: 's2', type: 'features', title: 'Why Choose Us', items: ['Premium Quality', '24/7 Support', 'Sustainable'] }
            ]
        }
    };

    // --- CORE APP CONTROLLER ---
    const app = {
        init: () => {
            const saved = localStorage.getItem('founderOS_v3');
            if(saved) {
                const parsed = JSON.parse(saved);
                store.profile = parsed.profile || store.profile;
                store.branding = parsed.branding || store.branding;
                store.builder = parsed.builder || store.builder;
            }
            
            // Hydrate Profile Inputs
            document.getElementById('p-industry').value = store.profile.industry;
            document.getElementById('p-keyword').value = store.profile.keyword;
            document.getElementById('p-desc').value = store.profile.desc;
            document.getElementById('p-audience').value = store.profile.audience;
            document.getElementById('p-phone').value = store.profile.phone;
            document.getElementById('p-email').value = store.profile.email;
            document.getElementById('site-color').value = store.builder.primaryColor;

            modules.builder.renderList();
            setTimeout(modules.builder.refresh, 500); // Delay for iframe load
        },

        saveProfile: () => {
            store.profile.industry = document.getElementById('p-industry').value;
            store.profile.keyword = document.getElementById('p-keyword').value;
            store.profile.desc = document.getElementById('p-desc').value;
            store.profile.audience = document.getElementById('p-audience').value;
            store.profile.phone = document.getElementById('p-phone').value;
            store.profile.email = document.getElementById('p-email').value;
            
            app.persist();
            app.route('branding');
        },

        persist: () => {
            localStorage.setItem('founderOS_v3', JSON.stringify(store));
        },

        route: (id) => {
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${id}`).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Simple active state toggle based on onclick index (simplified)
        }
    };

    // --- MODULES ---
    const modules = {
        
        // 1. BRANDING (PHONETIC ENGINE)
        branding: {
            generate: () => {
                const key = store.profile.keyword.replace(/[^a-zA-Z]/g, '') || "Nova";
                const vowels = "aeiou";
                const cons = "bcdfghjklmnpqrstvwxyz";
                const list = [];
                
                // Helper: Random Char
                const r = (str) => str[Math.floor(Math.random() * str.length)];
                // Helper: Cap
                const cap = (s) => s.charAt(0).toUpperCase() + s.slice(1);

                // A. Abstract (CVCV pattern - Nike Style)
                if(document.getElementById('style-abstract').checked) {
                    for(let i=0; i<5; i++) {
                        let name = r(cons) + r(vowels) + r(cons) + r(vowels);
                        if(Math.random() > 0.5) name += r(cons); // 5 letters
                        list.push({ name: cap(name), type: 'Abstract', domain: name.toLowerCase()+'.com' });
                    }
                }

                // B. Compound (FaceBook Style)
                if(document.getElementById('style-compound').checked) {
                    const suffixes = ['Hub', 'Box', 'Lab', 'Base', 'Works', 'Flow', 'Deck'];
                    const prefixes = ['Open', 'Go', 'Pro', 'Neo', 'Hyper', 'True'];
                    for(let i=0; i<5; i++) {
                        const s = suffixes[Math.floor(Math.random()*suffixes.length)];
                        list.push({ name: cap(key) + s, type: 'Compound', domain: (key+s).toLowerCase()+'.com' });
                    }
                }

                // C. Modern/Blends
                if(document.getElementById('style-tech').checked) {
                    const ends = ['ify', 'ly', 'io', 'ai', 'co'];
                    for(let i=0; i<4; i++) {
                        const end = ends[Math.floor(Math.random()*ends.length)];
                        list.push({ name: cap(key) + end, type: 'Tech', domain: (key+end).toLowerCase()+'.com' });
                    }
                }

                // Render
                const container = document.getElementById('name-results');
                container.innerHTML = '';
                list.sort(() => Math.random() - 0.5).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'name-badge';
                    div.innerHTML = `
                        <h3>${item.name}</h3>
                        <div class="name-meta">
                            <span>${item.type}</span>
                            <span><span class="avail-dot"></span>Available?</span>
                        </div>
                    `;
                    div.onclick = () => {
                        store.branding.selectedName = item.name;
                        document.getElementById('current-brand-name').innerText = item.name;
                        document.getElementById('selected-brand-display').style.display = 'block';
                        document.querySelectorAll('.name-badge').forEach(b => b.classList.remove('selected'));
                        div.classList.add('selected');
                        app.persist();
                        modules.builder.refresh(); // Update website
                    };
                    container.appendChild(div);
                });
            }
        },

        // 2. STRATEGY (ROADMAP)
        strategy: {
            run: () => {
                const ind = store.profile.industry;
                const roadmap = document.getElementById('roadmap-list');
                const ideas = document.getElementById('idea-tips');
                const comps = document.getElementById('competitor-list');
                
                // Generate Roadmap
                let steps = [
                    "Define your MVP (Minimum Viable Product).",
                    "Secure social media handles for " + store.branding.selectedName,
                    "Build landing page (Use the Builder tab).",
                    "Set up Google Analytics & Search Console."
                ];
                
                if(ind === 'food') {
                    steps.push("Apply for FSSAI/Food License.");
                    steps.push("Design packaging with eco-friendly materials.");
                    steps.push("Partner with Swiggy/Zomato for initial reach.");
                } else if (ind === 'service') {
                    steps.push("Create a portfolio PDF.");
                    steps.push("Set up a LinkedIn Company Page.");
                    steps.push("List services on Upwork/Fiverr.");
                }

                roadmap.innerHTML = steps.map((s,i) => `
                    <div style="display:flex; gap:10px; align-items:start; padding:10px; border-bottom:1px solid #eee;">
                        <div style="background:var(--primary); color:white; width:24px; height:24px; border-radius:50%; display:grid; place-items:center; font-size:0.8rem; flex-shrink:0;">${i+1}</div>
                        <div>${s}</div>
                    </div>
                `).join('');

                // Ideas
                ideas.innerHTML = `
                    <li><strong>Bundle Offer:</strong> Create a "Starter Pack" for new customers.</li>
                    <li><strong>Content Marketing:</strong> Write about "${store.profile.keyword} benefits" on your blog.</li>
                    <li><strong>Referral Program:</strong> Give 10% off if they bring a friend.</li>
                `;

                // Competitors (Simulated)
                comps.innerHTML = `
                    <p style="font-size:0.9rem; margin-bottom:5px;">Based on <strong>${store.profile.industry}</strong>:</p>
                    <div style="background:#F1F5F9; padding:10px; border-radius:4px; margin-bottom:5px;"><strong>Big Market Leader:</strong> High price, generic service. Beat them with personalization.</div>
                    <div style="background:#F1F5F9; padding:10px; border-radius:4px;"><strong>Local Player:</strong> Cheap, low quality. Beat them with branding & reliability.</div>
                `;

                document.getElementById('strategy-content').style.display = 'block';
            }
        },

        // 3. PRO WEBSITE BUILDER
        builder: {
            // Add a section with default data
            add: (type) => {
                const id = 's' + Date.now();
                let data = { id, type };
                
                if(type === 'hero') { data.title = "Transform Your Reality"; data.subtitle = "The best solution for " + store.profile.audience; data.btnText = "Get Started Now"; }
                if(type === 'text') { data.content = "Write your engaging content here. You can add multiple paragraphs."; }
                if(type === 'gallery') { data.title = "Our Gallery"; data.images = []; }
                if(type === 'contact') { data.title = "Get in Touch"; data.showMap = true; data.whatsapp = true; }
                if(type === 'features') { data.title = "Key Features"; data.items = ["Fast Delivery", "Premium Quality", "Eco-Friendly"]; }
                if(type === 'cta') { data.title = "Ready to Order?"; data.btnText = "Buy Now"; }

                store.builder.sections.push(data);
                modules.builder.renderList();
                modules.builder.refresh();
            },

            // Remove Section
            remove: (id) => {
                store.builder.sections = store.builder.sections.filter(s => s.id !== id);
                modules.builder.renderList();
                modules.builder.refresh();
            },

            // Move Up/Down
            move: (id, dir) => {
                const idx = store.builder.sections.findIndex(s => s.id === id);
                if(idx < 0) return;
                if(dir === -1 && idx > 0) {
                    [store.builder.sections[idx], store.builder.sections[idx-1]] = [store.builder.sections[idx-1], store.builder.sections[idx]];
                }
                if(dir === 1 && idx < store.builder.sections.length - 1) {
                    [store.builder.sections[idx], store.builder.sections[idx+1]] = [store.builder.sections[idx+1], store.builder.sections[idx]];
                }
                modules.builder.renderList();
                modules.builder.refresh();
            },

            // Handle Input Changes in Sidebar
            updateData: (id, field, value) => {
                const section = store.builder.sections.find(s => s.id === id);
                if(section) {
                    section[field] = value;
                    modules.builder.refresh(); // Live update
                }
            },

            // Image Upload Handler (Base64)
            handleImageUpload: (id, input) => {
                const section = store.builder.sections.find(s => s.id === id);
                if(input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        section.images.push(e.target.result);
                        modules.builder.refresh();
                        modules.builder.renderList(); // Re-render to show image count/preview
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            },

            // Renders the Sidebar List of Sections
            renderList: () => {
                const container = document.getElementById('section-list-container');
                container.innerHTML = '';
                
                store.builder.sections.forEach((s, idx) => {
                    const div = document.createElement('div');
                    div.className = 'section-item';
                    
                    // Specific Controls based on Type
                    let controls = '';
                    
                    if(s.type === 'hero' || s.type === 'cta') {
                        controls = `
                            <div class="form-group"><label>Title</label><input type="text" value="${s.title}" oninput="modules.builder.updateData('${s.id}', 'title', this.value)"></div>
                            <div class="form-group"><label>Button Text</label><input type="text" value="${s.btnText}" oninput="modules.builder.updateData('${s.id}', 'btnText', this.value)"></div>
                        `;
                    }
                    else if (s.type === 'contact') {
                        controls = `
                            <div class="form-group"><label>Title</label><input type="text" value="${s.title}" oninput="modules.builder.updateData('${s.id}', 'title', this.value)"></div>
                            <label><input type="checkbox" checked disabled> WhatsApp Integration (Uses Profile Phone)</label>
                        `;
                    }
                    else if (s.type === 'gallery') {
                        controls = `
                            <div class="form-group"><label>Title</label><input type="text" value="${s.title}" oninput="modules.builder.updateData('${s.id}', 'title', this.value)"></div>
                            <div class="form-group">
                                <label>Add Image</label>
                                <input type="file" accept="image/*" onchange="modules.builder.handleImageUpload('${s.id}', this)">
                                <small style="color:blue;">${s.images.length} images added</small>
                            </div>
                        `;
                    }
                    else {
                        controls = `<div class="form-group"><label>Title/Content</label><input type="text" value="${s.title || ''}" oninput="modules.builder.updateData('${s.id}', 'title', this.value)"></div>`;
                    }

                    div.innerHTML = `
                        <div class="section-header" onclick="this.nextElementSibling.classList.toggle('open')">
                            <span>${idx+1}. ${s.type.toUpperCase()}</span>
                            <div onclick="event.stopPropagation()">
                                <button class="btn-sm" onclick="modules.builder.move('${s.id}', -1)">‚Üë</button>
                                <button class="btn-sm" onclick="modules.builder.move('${s.id}', 1)">‚Üì</button>
                                <button class="btn-sm btn-danger" onclick="modules.builder.remove('${s.id}')">√ó</button>
                            </div>
                        </div>
                        <div class="section-body">
                            ${controls}
                        </div>
                    `;
                    container.appendChild(div);
                });
            },

            // Apply Presets
            applyTheme: () => {
                const theme = document.getElementById('site-theme').value;
                const colInput = document.getElementById('site-color');
                const txtInput = document.getElementById('site-text-color');

                if(theme === 'modern') { colInput.value = '#2563EB'; txtInput.value = '#0F172A'; }
                if(theme === 'luxury') { colInput.value = '#000000'; txtInput.value = '#333333'; }
                if(theme === 'playful') { colInput.value = '#F97316'; txtInput.value = '#431407'; }
                if(theme === 'minimal') { colInput.value = '#525252'; txtInput.value = '#171717'; }

                modules.builder.refresh();
            },

            // Generate HTML & Render to Iframe
            refresh: () => {
                const brand = store.branding.selectedName;
                const color = document.getElementById('site-color').value;
                const textColor = document.getElementById('site-text-color').value;
                const font = document.getElementById('site-theme').value === 'luxury' ? 'Playfair Display, serif' : 'Inter, sans-serif';
                
                let html = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1">
                        <style>
                            body { margin:0; font-family: ${font}; color: ${textColor}; line-height: 1.6; }
                            .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
                            .btn { background: ${color}; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: bold; }
                            h1, h2, h3 { line-height: 1.2; }
                            .nav { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
                            .logo { color: ${color}; font-weight: 800; font-size: 1.5rem; text-decoration: none; }
                            .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
                        </style>
                    </head>
                    <body>
                        <nav class="nav">
                            <a href="#" class="logo">${brand}</a>
                            <a href="#contact" style="color:${textColor}; text-decoration:none;">Contact</a>
                        </nav>
                `;

                store.builder.sections.forEach(s => {
                    // HERO
                    if(s.type === 'hero') {
                        html += `
                        <header style="text-align: center; padding: 80px 20px; background: ${color}10;">
                            <h1 style="font-size: 3rem; margin-bottom: 10px;">${s.title}</h1>
                            <p style="font-size: 1.2rem; opacity: 0.8; margin-bottom: 30px;">${s.subtitle}</p>
                            <a href="#contact" class="btn">${s.btnText}</a>
                        </header>`;
                    }
                    // FEATURES
                    else if(s.type === 'features') {
                        html += `
                        <section class="container" style="padding: 60px 20px;">
                            <h2 style="text-align: center; margin-bottom: 40px;">${s.title}</h2>
                            <div class="grid-3">
                                ${s.items.map(i => `<div style="padding:20px; border:1px solid #eee; border-radius:8px;"><h3>${i}</h3><p>Experience excellence.</p></div>`).join('')}
                            </div>
                        </section>`;
                    }
                    // GALLERY
                    else if(s.type === 'gallery') {
                        const imgs = s.images.length ? s.images.map(src => `<img src="${src}" style="width:100%; height:200px; object-fit:cover; border-radius:8px;">`).join('') : '<p>No images uploaded yet.</p>';
                        html += `
                        <section class="container" style="text-align: center; padding: 60px 20px;">
                            <h2>${s.title}</h2>
                            <div class="grid-3">${imgs}</div>
                        </section>`;
                    }
                    // CONTACT
                    else if(s.type === 'contact') {
                        const waLink = store.profile.phone ? `https://wa.me/${store.profile.phone.replace(/[^0-9]/g, '')}?text=Hi, I saw your website.` : '#';
                        html += `
                        <section id="contact" class="container" style="text-align: center; padding: 60px 20px; background: #f9f9f9;">
                            <h2>${s.title}</h2>
                            <p>Email: ${store.profile.email || 'Not provided'}</p>
                            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                                <a href="tel:${store.profile.phone}" class="btn">üìû Call Us</a>
                                <a href="${waLink}" class="btn" style="background:#25D366;">üí¨ WhatsApp</a>
                            </div>
                        </section>`;
                    }
                    // CTA
                    else if(s.type === 'cta') {
                        html += `
                        <section style="text-align: center; padding: 80px 20px; background: ${color}; color: white;">
                            <h2>${s.title}</h2>
                            <a href="#contact" style="background: white; color: ${color}; padding: 12px 30px; border-radius: 6px; text-decoration: none; font-weight: bold; margin-top: 20px; display: inline-block;">${s.btnText}</a>
                        </section>`;
                    }
                });

                html += `
                    <footer style="text-align: center; padding: 40px; font-size: 0.8rem; opacity: 0.6; margin-top: 40px;">
                        &copy; 2026 ${brand}. Built with FounderOS.
                    </footer>
                    </body></html>
                `;

                document.getElementById('preview-frame').srcdoc = html;
                return html;
            },

            export: () => {
                const html = modules.builder.refresh();
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${store.branding.selectedName}-website.html`;
                a.click();
            }
        }
    };

    // Initialize
    window.onload = app.init;
</script>
</body>
</html>
